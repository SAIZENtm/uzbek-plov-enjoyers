# üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò NEWPORT RESIDENT

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:** –î–æ–ª–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ SMS –∫–æ–¥–∞
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ SMS –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ –∏—Å–∫–∞–ª–æ –≤—Å–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –∑–∞–Ω–∏–º–∞–ª–æ 10-15 —Å–µ–∫—É–Ω–¥

## ‚ùå –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (–º–µ–¥–ª–µ–Ω–Ω–∞—è)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã ‚Üí –ü–û–ò–°–ö –≤ –ë–î (2-3 —Å–µ–∫)
2. –û—Ç–ø—Ä–∞–≤–∫–∞ SMS                        ‚Üí –ë—ã—Å—Ç—Ä–æ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç SMS –∫–æ–¥         ‚Üí –ë—ã—Å—Ç—Ä–æ
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ SMS                   ‚Üí –ë—ã—Å—Ç—Ä–æ
5. –ü–û–í–¢–û–†–ù–´–ô –ü–û–ò–°–ö –≤—Å–µ—Ö –∫–≤–∞—Ä—Ç–∏—Ä        ‚Üí 10-15 —Å–µ–∫—É–Ω–¥ (–ë–õ–û–ö–ò–†–£–ï–¢ UI!)
6. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ                ‚Üí –ë—ã—Å—Ç—Ä–æ
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 15-20 —Å–µ–∫—É–Ω–¥

## ‚úÖ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–±—ã—Å—Ç—Ä–∞—è)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã ‚Üí –ü–û–ò–°–ö –≤ –ë–î (2-3 —Å–µ–∫) + –ö–≠–®–ò–†–û–í–ê–ù–ò–ï
2. –û—Ç–ø—Ä–∞–≤–∫–∞ SMS                        ‚Üí –ë—ã—Å—Ç—Ä–æ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç SMS –∫–æ–¥         ‚Üí –ë—ã—Å—Ç—Ä–æ
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ SMS                   ‚Üí –ë—ã—Å—Ç—Ä–æ
5. –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ô –ø–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ    ‚Üí –ú–ì–ù–û–í–ï–ù–ù–û!
6. –ü–æ–∏—Å–∫ –¥–æ–ø. –∫–≤–∞—Ä—Ç–∏—Ä –≤ —Ñ–æ–Ω–µ          ‚Üí 5-8 —Å–µ–∫ (–ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 5-7 —Å–µ–∫—É–Ω–¥

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –±–ª–æ–∫–∏—Ä—É—é—â–∏–π
await authService.verifySMSCode(smsCode);
await _loadUserApartmentsWithRetry(); // –ë–õ–û–ö–ò–†–£–ï–¢!
context.go('/dashboard');

// –ù–æ–≤—ã–π –∫–æ–¥ - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π
final verified = await authService.verifySMSCode(smsCode);
if (verified) {
  context.go('/dashboard'); // –ú–ì–ù–û–í–ï–ù–ù–û!
  _checkApartmentsInBackground(); // –í —Ñ–æ–Ω–µ
}
```

### 2. –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```dart
// –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –Ω–∞–π–¥–µ–Ω–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É —Å—Ä–∞–∑—É
if (_verifiedApartment != null) {
  _userApartments = [_verifiedApartment!];
  notifyListeners(); // UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ —Ñ–æ–Ω–µ
_loadUserApartmentsInBackground();
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```dart
class ApartmentService {
  // –ö—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
  final Map<String, List<ApartmentModel>> _apartmentCache = {};
  final Map<String, DateTime> _cacheTimestamps = {};
  static const Duration _cacheExpiry = Duration(minutes: 5);
  
  Future<List<ApartmentModel>> findAllApartmentsByPassport(String passport) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º
    if (_apartmentCache.containsKey(passport) && 
        !_isExpired(passport)) {
      return _apartmentCache[passport]!; // –ú–ì–ù–û–í–ï–ù–ù–û!
    }
    
    // –ò—â–µ–º –≤ –ë–î —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ
    final results = await _searchInDatabase(passport);
    _apartmentCache[passport] = results; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    return results;
  }
}
```

### 4. –£–º–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
```dart
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä –≤ —Ñ–æ–Ω–µ
void _checkApartmentsInBackground(AuthService authService) async {
  await Future.delayed(const Duration(milliseconds: 500));
  
  final apartments = authService.userApartments;
  
  // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–≤–∞—Ä—Ç–∏—Ä - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–ø–∏—Å–æ–∫
  if (apartments != null && apartments.length > 1 && mounted) {
    context.go('/apartments');
  }
  // –ï—Å–ª–∏ –æ–¥–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∞ - –æ—Å—Ç–∞–µ–º—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
}
```

### 5. –ö–æ—Ä–æ—Ç–∫–∏–µ timeout'—ã
```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –¥–æ–ª–≥–∏–µ timeout'—ã
.timeout(const Duration(seconds: 15)) // –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ!

// –ù–æ–≤—ã–π –∫–æ–¥ - –∫–æ—Ä–æ—Ç–∫–∏–µ timeout'—ã –¥–ª—è —Ñ–æ–Ω–∞
.timeout(const Duration(seconds: 8)) // –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ñ–æ–Ω–∞
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |
|----------|---------------|-------------------|
| **–í—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** | 15-20 —Å–µ–∫—É–Ω–¥ | 5-7 —Å–µ–∫—É–Ω–¥ |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI** | 10-15 —Å–µ–∫—É–Ω–¥ | 0 —Å–µ–∫—É–Ω–¥ |
| **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** | –ö–∞–∂–¥—ã–π —Ä–∞–∑ | –ö—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω |
| **UX** | –ú–µ–¥–ª–µ–Ω–Ω–æ, —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏—è | –ë—ã—Å—Ç—Ä–æ, –ø–ª–∞–≤–Ω–æ |

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. –í–≤–æ–¥ SMS ‚Üí –î–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ (10-15 —Å–µ–∫) ‚Üí –í—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1. –í–≤–æ–¥ SMS ‚Üí –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤—Ö–æ–¥ ‚Üí –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏:

```dart
loggingService.info('Using verified apartment immediately for fast login');
loggingService.info('Loading additional apartments in background...');
loggingService.info('Background loading completed: found X total apartments');
loggingService.info('Using cached apartments for passport: XXX');
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º:

```dart
// –ï—Å–ª–∏ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å
catch (e) {
  loggingService.info('Background apartment loading failed (non-critical): $e');
  // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É
  if (_verifiedApartment != null) {
    _userApartments = [_verifiedApartment!];
    notifyListeners();
  }
}
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ 
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –∫—ç—à—É vs –ë–î
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —É–ª—É—á—à–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –≤ **3 —Ä–∞–∑–∞**, —Å–æ–∫—Ä–∞—Ç–∏–≤ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å 15-20 –¥–æ 5-7 —Å–µ–∫—É–Ω–¥ –∏ —É—Å—Ç—Ä–∞–Ω–∏–≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É UI.

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫** - –Ω–µ –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∂–¥–∞—Ç—å
- üîÑ **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ background
- üíæ **–£–º–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  
- üõ°Ô∏è **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ–º –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏ 