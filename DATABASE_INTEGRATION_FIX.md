# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏ –≤ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–π —Ñ–æ—Ä–º–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
Error submitting request: Exception: –î–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
–ù–æ–≤–∞—è Stepper —Ñ–æ—Ä–º–∞ –Ω–µ –∏–º–µ–ª–∞ –ø–æ–ª–Ω–æ–π –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å—Ç–∞—Ä–æ–π —Ñ–æ—Ä–º–µ.

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ —Å—Ç–∞—Ä–æ–π —Ñ–æ—Ä–º—ã

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
```dart
// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
if (apartmentData == null) {
  // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞
  if (userApartments != null && userApartments.isNotEmpty) {
    final firstApartment = userApartments.first;
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–≤—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É
    final requestId = await serviceRequestService.createServiceRequest(
      category: _selectedRequestType!,
      description: _description.trim(),
      apartmentNumber: firstApartment.apartmentNumber,
      blockName: firstApartment.blockId,
      priority: _selectedPriority,
      contactMethod: _selectedContactMethod,
      preferredTime: _selectedDateTime!,
      photos: _attachedPhotos,
      additionalData: {
        'requestSource': 'mobile_app',
        'userPhone': userData?['phone'] ?? firstApartment.phone ?? '',
        'userName': userData?['full_name'] ?? firstApartment.fullName ?? '',
      },
    );
    
    await _clearDraft();
    if (mounted) {
      _showSuccessDialog(requestId);
    }
    return;
  }
  
  // –ï—Å–ª–∏ –Ω–µ—Ç –≤–æ–æ–±—â–µ –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä
  throw Exception('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∑–∞–Ω–æ–≤–æ.');
}
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```dart
// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
getIt<LoggingService>().debug('Debug: isAuthenticated = ${authService.isAuthenticated}');
getIt<LoggingService>().debug('Debug: userData = ${authService.userData}');
getIt<LoggingService>().debug('Debug: verifiedApartment = ${authService.verifiedApartment}');
getIt<LoggingService>().debug('Debug: userApartments = ${authService.userApartments}');
```

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:**
```dart
String errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';

final errorString = e.toString();

if (errorString.contains('–∫–≤–∞—Ä—Ç–∏—Ä—ã')) {
  errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∑–∞–Ω–æ–≤–æ.';
} else if (errorString.contains('–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω')) {
  errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.';
} else if (errorString.contains('—Å–µ—Ä–≤–∏—Å–æ–≤')) {
  errorMessage = '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.';
}
// ... –∏ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω –¥–∏–∞–ª–æ–≥ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

```dart
void _showSuccessDialog(String requestId) {
  showDialog(
    context: context,
    barrierDismissible: false,
    builder: (BuildContext context) {
      return AlertDialog(
        title: Row(
          children: [
            const Icon(Icons.check_circle, color: Colors.green, size: 24),
            const SizedBox(width: 8),
            Text('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞', style: AppTheme.lightTheme.textTheme.titleLarge),
          ],
        ),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Text('–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.'),
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏
            Container(
              padding: const EdgeInsets.all(12),
              child: Text('#${requestId.substring(0, 8)}', 
                style: TextStyle(fontWeight: FontWeight.bold, fontFamily: 'monospace')),
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () {
              Navigator.of(context).pop(); // –ó–∞–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥
              Navigator.of(context).pop(); // –ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
            },
            child: const Text('–ó–∞–∫—Ä—ã—Ç—å'),
          ),
          BlueButton(
            text: '–ú–æ–∏ –∑–∞—è–≤–∫–∏',
            onPressed: () {
              Navigator.of(context).pop(); // –ó–∞–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥
              Navigator.of(context).pop(); // –ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
              context.go('/services/requests'); // –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞—è–≤–∫–∞–º
            },
          ),
        ],
      );
    },
  );
}
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. ‚úÖ **–û—à–∏–±–∫–∞ "–î–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –ª–æ–≥–∏–∫–∞
2. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞
3. ‚úÖ **–°–ª–∞–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
4. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–∞–ª–æ–≥–∞ —É—Å–ø–µ—Ö–∞** - –¥–æ–±–∞–≤–ª–µ–Ω –∫—Ä–∞—Å–∏–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞—è–≤–∫–∏

### –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ verifiedApartment** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞
3. **Fallback –Ω–∞ userApartments** - –µ—Å–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞—è
4. **–î–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
5. **Graceful error handling** - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Firebase —á–µ—Ä–µ–∑ `ServiceRequestService`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö: —Ç–∏–ø –∑–∞—è–≤–∫–∏, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∫–æ–Ω—Ç–∞–∫—Ç, –≤—Ä–µ–º—è, —Ñ–æ—Ç–æ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (`additionalData`)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
flutter analyze  # ‚úÖ –ë–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
flutter run      # ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:
1. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —à–∞–≥–∏ —Ñ–æ—Ä–º—ã
2. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
3. –ó–∞—è–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è
4. –ü–æ—è–≤–∏—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞—è–≤–∫–∏
5. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Firebase

## üéâ –ì–æ—Ç–æ–≤–æ!
–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! 