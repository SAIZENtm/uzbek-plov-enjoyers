<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background: #007cba;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background: #005a8b;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .info {
            background: #e2f3ff;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        .test-buttons {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .test-buttons button {
            flex: 1;
            min-width: 200px;
        }
        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        .config-section h3 {
            margin-top: 0;
            color: #495057;
        }
        .config-input {
            margin-bottom: 10px;
        }
        .config-input input {
            margin-bottom: 5px;
        }
        .status {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .status.connected {
            color: #28a745;
        }
        .status.disconnected {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h1>
        
        <div class="status" id="connectionStatus">
            ‚ö†Ô∏è –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase
        </div>
        
        <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase -->
        <div class="config-section">
            <h3>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase</h3>
            <div class="config-input">
                <input type="text" id="apiKey" placeholder="API Key" value="AIzaSyDxVpK8_your_api_key">
            </div>
            <div class="config-input">
                <input type="text" id="projectId" placeholder="Project ID" value="newport-23a19">
            </div>
            <button onclick="connectFirebase()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Firebase</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
        <form id="notificationForm">
            <div class="form-group">
                <label for="userId">üë§ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞):</label>
                <input type="text" id="userId" required placeholder="AC3077863" value="AC3077863">
            </div>
            
            <div class="form-group">
                <label for="title">üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
                <input type="text" id="title" required placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" value="–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">
            </div>
            
            <div class="form-group">
                <label for="message">üí¨ –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
                <textarea id="message" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.</textarea>
            </div>
            
            <div class="form-group">
                <label for="type">üè∑Ô∏è –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
                <select id="type">
                    <option value="system">üì¢ –°–∏—Å—Ç–µ–º–Ω–æ–µ</option>
                    <option value="admin_response">üë®‚Äçüíº –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</option>
                    <option value="service_update">üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="adminName">üë§ –ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
                <input type="text" id="adminName" placeholder="–ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" value="–¢–µ—Å—Ç –ê–¥–º–∏–Ω">
            </div>
            
            <div class="form-group">
                <label for="relatedRequestId">üîó ID —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <input type="text" id="relatedRequestId" placeholder="–ï—Å–ª–∏ —Å–≤—è–∑–∞–Ω–æ —Å –∑–∞—è–≤–∫–æ–π">
            </div>
            
            <button type="submit" id="sendButton">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
        </form>
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã -->
        <div class="test-buttons">
            <button onclick="sendTestSystem()">üì¢ –¢–µ—Å—Ç: –°–∏—Å—Ç–µ–º–Ω–æ–µ</button>
            <button onclick="sendTestAdmin()">üë®‚Äçüíº –¢–µ—Å—Ç: –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∞</button>
            <button onclick="sendTestService()">üîß –¢–µ—Å—Ç: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
            <button onclick="getUsersList()">üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="result"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

    <script>
        let db = null;
        let isConnected = false;
        
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
        function connectFirebase() {
            const apiKey = document.getElementById('apiKey').value;
            const projectId = document.getElementById('projectId').value;
            
            if (!apiKey || !projectId) {
                showResult('‚ùå –í–≤–µ–¥–∏—Ç–µ API Key –∏ Project ID', 'error');
                return;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: apiKey,
                    authDomain: `${projectId}.firebaseapp.com`,
                    projectId: projectId,
                    storageBucket: `${projectId}.appspot.com`,
                };
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                db.collection('notifications').limit(1).get()
                    .then(() => {
                        isConnected = true;
                        updateConnectionStatus();
                        showResult('‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase!', 'success');
                    })
                    .catch(error => {
                        showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                    });
                    
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (isConnected) {
                statusElement.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                statusElement.className = 'status connected';
            } else {
                statusElement.textContent = '‚ö†Ô∏è –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                statusElement.className = 'status disconnected';
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        async function sendNotification(userId, title, message, type = 'system', options = {}) {
            if (!isConnected) {
                throw new Error('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase');
            }
            
            const notificationId = generateUniqueId();
            
            const notification = {
                id: notificationId,
                userId: userId,
                title: title,
                message: message,
                type: type,
                createdAt: new Date().toISOString(),
                readAt: null,
                isRead: false,
                data: options.data || {},
                relatedRequestId: options.relatedRequestId || null,
                adminName: options.adminName || '–¢–µ—Å—Ç –ê–¥–º–∏–Ω',
                imageUrl: options.imageUrl || null
            };
            
            await db.collection('notifications').doc(notificationId).set(notification);
            return { success: true, id: notificationId };
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
        document.getElementById('notificationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const button = document.getElementById('sendButton');
            button.disabled = true;
            button.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            try {
                const formData = {
                    userId: document.getElementById('userId').value,
                    title: document.getElementById('title').value,
                    message: document.getElementById('message').value,
                    type: document.getElementById('type').value,
                    adminName: document.getElementById('adminName').value,
                    relatedRequestId: document.getElementById('relatedRequestId').value || null
                };
                
                const result = await sendNotification(
                    formData.userId,
                    formData.title,
                    formData.message,
                    formData.type,
                    { 
                        adminName: formData.adminName,
                        relatedRequestId: formData.relatedRequestId 
                    }
                );
                
                showResult(`‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!<br>ID: ${result.id}<br>üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`, 'success');
                
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            }
        });
        
        // –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
        async function sendTestSystem() {
            if (!isConnected) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Firebase', 'error');
                return;
            }
            
            try {
                const result = await sendNotification(
                    'AC3077863',
                    '–°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
                    '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',
                    'system'
                );
                showResult(`‚úÖ –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ID: ${result.id}`, 'success');
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        async function sendTestAdmin() {
            if (!isConnected) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Firebase', 'error');
                return;
            }
            
            try {
                const result = await sendNotification(
                    'AC3077863',
                    '–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
                    '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞. –í—Å–µ —Ä–∞–±–æ—Ç—ã –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π.',
                    'admin_response',
                    { 
                        adminName: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                        relatedRequestId: 'test_request_123'
                    }
                );
                showResult(`‚úÖ –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! ID: ${result.id}`, 'success');
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        async function sendTestService() {
            if (!isConnected) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Firebase', 'error');
                return;
            }
            
            try {
                const result = await sendNotification(
                    'AC3077863',
                    '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –∑–∞—è–≤–∫–µ',
                    '–ú–∞—Å—Ç–µ—Ä –≤—ã–µ—Ö–∞–ª –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –ø–æ –≤–∞—à–µ–π –∑–∞—è–≤–∫–µ',
                    'service_update',
                    { relatedRequestId: 'test_request_456' }
                );
                showResult(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —É—Å–ª—É–≥–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ID: ${result.id}`, 'success');
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function getUsersList() {
            if (!isConnected) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Firebase', 'error');
                return;
            }
            
            try {
                const usersSnapshot = await db.collection('users').get();
                const users = [];
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    const userId = userData.passport_number || userData.passportNumber;
                    if (userId) {
                        users.push({
                            id: userId,
                            name: userData.full_name || userData.fullName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                            email: userData.email || '–ù–µ—Ç email'
                        });
                    }
                });
                
                let usersList = users.map(user => 
                    `‚Ä¢ ${user.name} (${user.id}) - ${user.email}`
                ).join('<br>');
                
                showResult(`üë• –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}<br><br>${usersList}`, 'info');
                
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}`, 'error');
            }
        }
        
        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = `result ${type}`;
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateConnectionStatus();
    </script>
</body>
</html> 